<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
		<link rel="stylesheet" type="text/css" href="css/queryAudit.css" />
		<link rel="stylesheet" type="text/css" href="css/loading.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;"></a>
		    <h1 class="mui-title" style="color: white;">查询结果</h1>
		</header>
		
		<div class="v-box" style="padding-top: 44px;">
			<div class="flex-box" >
				<c-listView id="queryList" style="margin-top: 0em;width: 210%;overflow: scroll;background-color: white;">
				<template name="row">
					<li style="margin-top:0.7em;">
						<div class="box">
							<label c-bind="getName(items)" style="color: #439CF6;font-size: 1.3em;"></label>
						</div>
						<div class="h-box" id="title" style="text-align: center;padding-left: 0%;">
							<div c-repeat="title in titles" c-widget="#titles"></div>
						</div>
						<div c-repeat="item in items" c-widget="#labelRow">
						</div>
					</li>
				</template>			        
			</c-listView>
			</div>
		</div>
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./resources/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script src="./js/loading.js"></script>
		<script type="text/javascript">
			mui.init();
			cola(function(model){
				model.set("titles", ["交货单", "工厂", "交期", "订单数", "工厂发货数"]);
				
				$('#queryList').css("font-size",(window.screen.width/375.0)*12);
				
				mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				var param = self.queryData;
				var load = new Loading();
				load.init();
				load.start();
				$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/storage_daily_delivery_plan/list",
						//提交的数据
						data: JSON.stringify(param),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
							console.log(JSON.stringify(data));
							load.stop();
							if(data.status == "300"){
								mui.toast('无效索引',{ duration:'short', type:'div' });
								return ;
							}
							var dataList = data.dataList; 
							if(dataList.length == 0){
								mui.toast('暂无数据',{ duration:'short', type:'div' });
								return;
							}
							var tmpItms = [];
							var titles = [];
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["SUPPLIER_NAME"];
								e["PO_AMOUNT"] = "" + e["PO_AMOUNT"];
								e["PACKED_AMOUNT"] = "" + e["PACKED_AMOUNT"];
								if(titles.length == 0){
									titles.push(title);
								}else{ 
									var count = 0;
									for(i = 0 ; i<titles.length ; i++){
										if(title == titles[i]){
											break;
										}else{
											count++;
										}
										if(count == titles.length){
											titles.push(title);
										}
								}
								}
							}
							
							var sitems = [];
							for(i = 0 ; i < titles.length ; i++){
								 sitems.push([{"SKU":titles[i]}]);
							}
							
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["SUPPLIER_NAME"];
								for(i = 0 ; i <sitems.length ; i ++){
									var titleObj = sitems[i][0];
									if(titleObj["SKU"] == title){
										sitems[i].push(e);
									}
								}
							}
							
							for(i = 0 ; i < sitems.length ; i++){
								var objs = sitems[i];
								for(j = 0 ; j < objs.length ; j++){
									if(objs[j]["SKU"]){
										objs.splice(j,1);
									}
								}
							}
							model.set("itemes",sitems);
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
							console.log(JSON.stringify(e));
						}
					});
				});
				
				model.action({
					getName:function(items){
						
						return items[0].SUPPLIER_NAME;
					}
				});
				
				model.widgetConfig({
		            queryList: {
		                $type: "listView",
		                bind: "items in itemes",
		                highlightCurrentItem:false,
		                getItemTemplate: function(arg) {
		                    return "row";
		                }
		            },
			        labelRow: {
						$type:"table",
						bind: "i in item",
						showHeader: true,
						highlightCurrentItem:false,
						renderRow: function(self, arg) {
						},
						columns: [{
							align:"center",
							caption:"{{item.RECEIPT_CODE}}",
							height:"1"
						}, {
							align:"center",
							caption:"{{item.SUPPLIER_NAME}}"
						}, {
							align:"center",
							caption:"{{item.PO_DELIVERY_DATE}}"
						}, {
							align:"center",
							caption:"{{item.PO_AMOUNT}}"
						}, {
							align:"center",
							caption:"{{item.PACKED_AMOUNT}}"
						}]
					},
					titles: {
		                $type: "label",
		                width:window.screen.width*(2.1)/5,
		                text: "{{title}}",
		            }
	        	});
			});
		</script>
	</body>

</html>