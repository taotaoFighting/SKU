<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
		<link rel="stylesheet" type="text/css" href="css/queryAudit.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title" style="color: white;">查询结果</h1>
		</header>
		<div class="v-box">
			<c-listView id="queryList" itemClick="itemClick">
				<template name="row">
					<li style="margin-top:0.7em;background-position: right;background-image: url(img/assess.png);background-repeat: no-repeat;">
						<div class="v-box">
						    <div class="box" style="margin-left: 3%;width: 97%;">
						    	<label>交货单状态：<span c-bind="transformCode(item)"></span></label>
						    	<label id="labelSpace">交货单编号：<span c-bind="item.receiptCode"></span></label>
						    </div>
						     <div class="box" id="boxRow">
						    	<label>箱数：<span c-bind="item.boxNum"></span></label>
						    	<label id="labelSpace">数量：<span c-bind="item.productNum"></span></label>
						    	<label id="labelSpace">入库方式：<span c-bind="transfromStorageWay(item)"></span></label>
						    	<label id="labelSpace">折扣率：<span c-bind="item.discount"></span></label>
						    	<!--<img style="width: 2em;position: fixed;margin-right: 10em;" src="img/assess.png"/>-->
						    </div>
						     <div class="box" id="boxRow" style="margin-bottom: 6px;">
						    	<label>预计到货时间：<span c-bind="item.predictReceiptDate"></span></label>
						    </div>
						</div>
					</li>
				</template>		
				<template name="pull-up-pane">
			        <div style="height:72px;padding-bottom:72px">
			            <div id="divPullUp" style="line-height:48px"></div>
			        </div>
			    </template>
			</c-listView>
		</div>
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./js/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();
			cola(function(model){
				
//				alert(window.screen.width)
				$('#queryList').css("font-size",(window.screen.width/375.0)*12);
				model.action({
					itemClick:function(self,arg){
						var receiptStatus = arg.item.get("receiptStatus");
						var storageWay = arg.item.get("storageWay");
						arg.item.set("receiptStatus",model.action.transformCode(arg.item));
						arg.item.set("storageWay",model.action.transfromStorageWay(arg.item));
						alert(receiptStatus + storageWay)
						mui.openWindow({
						    url: 'sku-auditDetial.html', 
						    id:'auditDetial',
						    extras:{
						        data: arg.item,//扩展参数
						        receiptStatus:receiptStatus,
						        storageWay:storageWay
						    }
						 });
					},
					transformCode:function(item){
						var receiptStatus = "";
						model.get("DelOrderStatus").each(function(e){
							if(item.get("receiptStatus") == e.get("enumvCode")){
								receiptStatus = e.get("enumvName");
							}
						})
						return receiptStatus;
					},
					transfromStorageWay:function(item){
						var storageWay = "";
						model.get("StorageWay").each(function(e){
							if(item.get("storageWay") == e.get("enumvCode")){
								storageWay = e.get("enumvName");
							}
						})
						return storageWay;
					}
				});
				
				mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				var param = self.queryData;
				model.set("StorageWay",self.StorageWay);
				model.set("DelOrderStatus",self.DelOrderStatus);
				param["pageSize"]="20";
				param["pageNo"]="1";
				$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/delivery_note/header/list",
						//提交的数据
						data: JSON.stringify(param),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
							model.set("items",data.data.entities); 
							
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
							console.log(JSON.stringify(e))
						}
					});
				});
				
				model.widgetConfig({
		            queryList: {
		                $type: "listView",
		                bind: "item in items",
		                height:window.screen.height - 54,
		                pullUp:false, 
		                pullStep: function(arg) {
		                    $("#divPullUp").text((arg.distance < arg.theshold) ? "继续上拉加载更多" : "释放以刷新");
		                },
		                pullComplete: function(self,arg) {
		                    $("#divPullUp").text("正在加载...");
		                    arg.done();
		                },
		                getItemTemplate: function(arg) {
		                    return "row";
		                }
		            }
	        	});
			});
		</script>
	</body>

</html>