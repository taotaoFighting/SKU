<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title></title>
    <link href="css/mui.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="./resources/semantic.css">
	<link rel="stylesheet" type="text/css" href="./resources/cola.css">
</head>
<body>
	
	<div class="v-box">
		<div class="box">
			<div style="background-color: #439CF6;color: white;width: 100%;height: 3.0em;text-align: center;">
				<div style="padding-top: 0.65em;font-size: 1.2em;">用户登录</div>
			</div>
		</div>
		<div class="flex-box">
			<div class="v-box">
				<div class="box" style="width: 100%;height: 50%;background-color: white;">
				</div>
			<div class="v-box">
				<div class="v-box" style="width: 90%;margin-left: 5%;">
					<label style="margin-top: 2em;">账号：<c-input c-bind="param.userName" c-widget="placeholder:请输入账号;width:85%"></c-input></label>
					<label style="margin-top: 1.5em;">密码：<c-input c-bind="param.password" c-widget="placeholder:请输入密码;width:85%"></c-input></label>
					<div style="margin-top: 2em;">
						<c-checkbox id="pwd" label="记住密码" checked="true" click="change" style="margin-left: 3em;"></c-checkbox>
						<span style="margin-left: 30%;border-bottom: solid 1px;">忘记密码?</span>
					</div>
					<div class="box" style="margin-top: 5em;">
						<c-button  color="blue" c-widget="caption:登录;width:90%;click:launch" style="margin-left: 5%;"></c-button>
					</div>
				</div>
			</div>
			</div>
		</div>
	</div>
	
	<script src="./resources/jquery-2.1.3.js"></script> 
	<script src="./resources/3rd.js"></script>
	<script src="./resources/semantic.js"></script>
	<script src="./js/cola.js"></script>
	<script src="./resources/i18n/zh/cola.js"></script>
	<script src="./js/mui.min.js"></script>
	<script type="text/javascript">
		
		
		document.addEventListener('plusready',plusReady,false);
		function plusReady(){
			plus.navigator.setStatusBarBackground('#439CF6');
			localStorage.setItem("localhost","http://202.96.245.236:8080");
		};
		cola(function(model){
			model.set({
				"param":{},
				"isSavepad":true
			});
			
			if(localStorage.getItem("password")){
				model.get("param").set("password",localStorage.getItem("password"));
			}
			
			if(localStorage.getItem("userName")){
				model.get("param").set("userName",localStorage.getItem("userName"));
			}
			
			model.action({
				launch:function(){
					$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/login",
						//提交的数据
						data: JSON.stringify(model.get("param")),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
							console.log(JSON.stringify(data))
							if(data.msg == "登陆成功！"){
								localStorage.setItem("firstLaunch",false);
								localStorage.setItem("userName",model.get("param").get("userName"));
								localStorage.setItem("passwordDefault",model.get("param").get("password"));
								if(model.get("isSavepad")){
									localStorage.setItem("password",model.get("param").get("password"));
								}else{
									localStorage.removeItem("password");
								}
								mui.openWindow({
							    url: 'tab-webview-main.html', 
							    id:'setting',
							    styles:{
		    						popGesture:'none'	
		    					}
							  });
							}else{
								mui.toast('账号或密码错误！',{ duration:'short', type:'div'});
							}
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
						}
					});
					
				},
				change:function(){
					model.set("isSavepad",!model.get("isSavepad"));
					console.log(model.get("isSavepad"))
				}
			});
		})
	</script>
	
</body>
</html>