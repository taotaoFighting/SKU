<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
		<link rel="stylesheet" type="text/css" href="css/queryAudit.css" />
		<link rel="stylesheet" type="text/css" href="css/loading.css" />
	</head>
	
	<body>
		
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;"></a>
		    <h1 class="mui-title" style="color: white;">日剩余货获量查询结果</h1>
		</header>
		<div class="v-box" style="height: 100%;width: 100%;overflow: scroll;padding-top: 50px;"> 
			<div class="box">
				<div class="h-box" id="title" style="width: 150%;">
					<div c-repeat="title in titles" c-widget="#titles"></div>
				</div>
				<div class="flex-box">
					<div id="queryTable" style="font-size: 0.9em;width: 150%;overflow: scroll;background-color: white;">
					<template name="int-template">
				        <div c-widget="input; bind:$default; class:fluid" c-class="error:$default>500"></div>
				    </template>
				</div>
				</div>
			</div>
		</div>
		
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./resources/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script src="./js/loading.js"></script>
		<script type="text/javascript">
			mui.init();
			cola(function(model){
				model.set("titles", ["日期", "品牌", "最大限额","限额单位", "收获量", "剩余量"]);
				mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				var param = self.queryData;
				var load = new Loading();
				load.init();
				load.start();
				$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/storage_daily_ceiling/list",
						//提交的数据
						data: JSON.stringify(param),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
							load.stop();
							if(data.status == "300"){
								mui.toast("无效索引！",{ duration:'short', type:'div' });
								return;
							}
							var dataList = data.dataList;
							var tmpItms = [];
							var titles = [];
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["CUSTOMER_NAME"];
								if(titles.length == 0){
									titles.push(title);
								}else{
									var count = 0;
									for(i = 0 ; i<titles.length ; i++){
										if(title == titles[i]){
											break;
										}else{
											count++;
										}
										if(count == titles.length){
											titles.push(title);
										}
								}
								}
							}
							
							var sitems = [];
							for(i = 0 ; i < titles.length ; i++){
								 sitems.push([{"LIMITED_DATE":titles[i]}]);
							}
							
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["CUSTOMER_NAME"];
								for(i = 0 ; i <sitems.length ; i ++){
									var titleObj = sitems[i][0];
									if(titleObj["LIMITED_DATE"] == title){
										sitems[i].push(e);
									}
								}
							}
							
							for(i = 0 ; i < sitems.length ; i++){
								var objs = sitems[i];
								for(j = 0 ; j < objs.length ; j++){
									tmpItms.push(objs[j]);
								}
							}
							
							model.set("items",tmpItms);
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
						}
					});
				});
				
				model.widgetConfig({
		            queryTable: {
		                $type: "table",
		                bind: "item in items",
		                showHeader: false, 
		                height:window.screen.height - 100, 
		                columns: [{
		                    bind: ".LIMITED_DATE",
		                    caption: "日期",
		                    align: "center",
		                }, {
		                    bind: ".BRAND",
		                    caption: "品牌",
		                    align: "center"
		                }, {
		                    bind: ".CEILING",
		                    caption: "最大限额",
		                    align: "center"
		                }, {
		                    bind: ".LIMITED_UNIT",
		                    caption: "限额单位",
		                    align: "center"
		                }, {
		                    bind: ".USED_CEILING",
		                    caption: "收货量",
		                    align: "center"
		                },{
		                    bind: ".UNUSED_CEILING",
		                    caption: "剩余量",
		                    align: "center",
		                }]
		            },
					titles: {
		                $type: "label", 
		                width:window.screen.width*1.49/5,
		                text: "{{title}}",
		            }
		        });
			});
		</script>
	</body>

</html>