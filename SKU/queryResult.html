<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
	</head>
	
	<body>
		
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title" style="color: white;">2017春季第一波</h1>
		</header>
		<div class="v-box" style="height: 100%;width: 100%;overflow: scroll;margin-top: 50px;">
			<div class="box">
				<div class="h-box" style="text-align: center;width: 350%;color: #439CF6;">
					<div c-repeat="title in titles" c-widget="#titles"></div>
				</div>
			<div class="flex-box">
				<div id="queryTable" style="font-size: 0.9em;width: 350%;overflow: scroll;">
					<template name="int-template">
				        <div c-widget="input; bind:$default; class:fluid" c-class="error:$default>500"></div>
				    </template>
				</div>
			</div>
			</div>
		</div>
		
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./resources/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();
			cola(function(model){
				model.set("titles", ["SKU", "采购订单号", "订单交期","订单数", "波段", "工厂","入库日期","入库数","工厂发货数","未入库数"]);
				mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				var param = self.queryData;
				$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/product_distribution/list",
						//提交的数据
						data: JSON.stringify(param),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
//							model.set("items",data.dataList);
							var dataList = data.dataList;
							var tmpItms = [];
							var titles = [];
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["SUPPLIER_NAME"]+","+e["WAVE_NAME"];
								console.log(JSON.stringify(e))
								if(titles.length == 0){
									titles.push(title);
								}else{
									var count = 0;
									for(i = 0 ; i<titles.length ; i++){
										if(title == titles[i]){
											break;
										}else{
											count++;
										}
										if(count == titles.length){
											titles.push(title);
										}
								}
								}
							}
							
							var sitems = [];
							for(i = 0 ; i < titles.length ; i++){
								 sitems.push([{"SKU":titles[i]}]);
							}
							
							for(k = 0 ; k < dataList.length ; k++){
								var e = dataList[k];
								var title = e["SUPPLIER_NAME"]+","+e["WAVE_NAME"];
								for(i = 0 ; i <sitems.length ; i ++){
									var titleObj = sitems[i][0];
									if(titleObj["SKU"] == title){
										sitems[i].push(e);
									}
								}
							}
							
							for(i = 0 ; i < sitems.length ; i++){
								var objs = sitems[i];
								for(j = 0 ; j < objs.length ; j++){
									tmpItms.push(objs[j]);
								}
							}
							
							model.set("items",tmpItms);
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
						}
					});
				});
				
				model.widgetConfig({
		            queryTable: {
		                $type: "table",
		                bind: "item in items",
		                showHeader: false, 
		                height:window.screen.height - 100, 
		                columns: [{
		                    bind: ".SKU",
		                    caption: "SKU",
		                    align: "center",
		                }, {
		                    bind: ".PO_CODE",
		                    caption: "采购订单号",
		                    align: "center"
		                }, {
		                    bind: ".PO_DELIVERY_DATE",
		                    caption: "订单交期",
		                    align: "center"
		                }, {
		                    bind: ".PO_AMOUNT",
		                    caption: "订单数",
		                    align: "center"
		                }, {
		                    bind: ".WAVE_NAME",
		                    caption: "波段",
		                    align: "center"
		                },{
		                    bind: ".SUPPLIER_NAME",
		                    caption: "工厂",
		                    align: "center",
		                }, {
		                    bind: ".RECEIVED_DATE",
		                    caption: "入库日期",
		                    align: "center"
		                }, {
		                    bind: ".RECEIVED_AMOUNT",
		                    caption: "入库数",
		                    align: "center"
		                }, {
		                    bind: ".PACKED_AMOUNT",
		                    caption: "工厂发货数",
		                    align: "center"
		                }, {
		                    bind: ".UN_RECEIVED_AMOUNT",
		                    caption: "未入库数",
		                    align: "center"
		                }]
		            },
					titles: {
		                $type: "label", 
		                width:window.screen.width*3.5/5,
		                color:"blue",
		                text: "{{title}}",
		            }
		        });
			});
		</script>
	</body>

</html>