<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
		<link rel="stylesheet" type="text/css" href="./css/dayMaintain.css"> 
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title" style="color: white;">日收货量维护</h1>
		</header>
		<div class="v-box" style="padding-top: 54px;">
			<div class="v-box" style="width: 80%;margin-left: 5%;text-align: right;">
			<label id="rowLabel">仓库：<c-input  id="formInput" c-bind="queryData.storageCode" c-widget="width:70%"><!--<c-dropdown  id="formInput" c-bind="queryData.storageCode" items="{{resp}}" openmode="drop" valueProperty="label" textProperty="label" c-widget="width:70%"></c-dropdown>--></label>
			<label id="rowLabel">品牌：<c-dropdown  id="formInput" c-bind="queryData.brand" items="{{band}}" openmode="drop" valueProperty="enumvCode" textProperty="enumvName" c-widget="width:70%"></c-input></label> 
			<label id="rowLabel">开始日期：<c-datePicker id="formInput" c-widget="width:70%;bind:queryData.dateS"></c-datePicker></label>
			<label id="rowLabel">结束日期：<c-datePicker id="formInput" c-widget="width:70%;bind:queryData.dateE"></c-datePicker></label>
			<label id="rowLabel">最大限额：<c-input  id="formInput" c-bind="queryData.ceiling" c-widget="width:70%"></c-input></label>
			<label id="rowLabel" style="text-align: center;margin-top: 10%;">
					<c-checkbox id="boxs" label="按箱维护" click="change" checked="true" style="margin-left: 3em;"></c-checkbox>
					<c-checkbox id="nubs" label="按量维护" click="change" style="margin-left: 3em;"></c-checkbox>
			</label>
			<div class="box" style="margin-top: 20%;">
				<c-button class="basic" color="blue" c-widget="caption:提交;width:90%;click:commit" style="margin-left: 5%;"></c-button>
			</div>
			</div>
		</div>
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./js/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init()
			cola(function(model){
				
				model.set({
					resp:[{
						label:"仓库1",
					},{
						label:"仓库2",
					},{
						label:"仓库3",
					}],
					queryData:{limitedUnit:"箱"}
				});
				model.describe("band",{
					provider:{
						method:"POST",
						url:localStorage.getItem("localhost")+"/scmmk/rest/mobile/enum/Brand/list",
						success:function(arg){
							model.set("band",arg.result.dataList);
						}
					}
				});
				
				model.action({
					change:function(self,arg){
						if(self.get("label") == "按箱维护"){
							cola.widget("nubs").set("checked",false);
							if(model.get("queryData").get("limitedUnit") == "箱"){  
								model.get("queryData").set("limitedUnit","件");
								cola.widget("nubs").set("checked",true);
							}else{
								model.get("queryData").set("limitedUnit","箱");
							}
						}else{
							cola.widget("boxs").set("checked",false);
							if(model.get("queryData").get("limitedUnit") == "件"){   
								model.get("queryData").set("limitedUnit","件");
								cola.widget("boxs").set("checked",true);
							}else{
								model.get("queryData").set("limitedUnit","件");
							}
						}
						
					},
					commit:function(){
						if(!model.get("queryData").get("storageCode")){
							mui.toast('仓库不能为空',{ duration:'short', type:'div' });
							return;
						}
						if(!model.get("queryData").get("brand")){
							mui.toast('品牌不能为空',{ duration:'short', type:'div' });
							return;
						}
						if(!model.get("queryData").get("dateS")){
							mui.toast('开始日期不能为空',{ duration:'short', type:'div' });
							return;
						}
						if(!model.get("queryData").get("dateE")){
							mui.toast('结束日期不能为空',{ duration:'short', type:'div' });
							return;
						}
						if(!model.get("queryData").get("ceiling")){
							mui.toast('最大限额不能为空',{ duration:'short', type:'div' });
							return;
						}
						console.log(JSON.stringify(model.get("queryData")))
						//检查是否已维护
						$.ajax({
						type: "POST",
						contentType:'application/json;charset=UTF-8',
						url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/storage_daily_ceiling/check",
						//提交的数据
						data: JSON.stringify(model.get("queryData")),
						//返回数据的格式
						datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
						success: function(data) {
							console.log(JSON.stringify(data))
							if(data.msg == ""){
								$.ajax({
									type: "POST",
									contentType:'application/json;charset=UTF-8',
									url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/storage_daily_ceiling/add",
									//提交的数据
									data: JSON.stringify(model.get("queryData")),
									//返回数据的格式
									datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
									success: function(data) {
										console.log(JSON.stringify(data))
									},
									//调用出错执行的函数
									error: function(e) {
										//请求出错处理
									}
								});
							}else{
								var btnArray = ['取消', '覆盖'];
								mui.confirm(data.msg,'注意？', btnArray, function(e) {
									if (e.index == 1) {
										$.ajax({
											type: "POST",
											contentType:'application/json;charset=UTF-8',
											url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/storage_daily_ceiling/add",
											//提交的数据
											data: JSON.stringify(model.get("queryData")),
											//返回数据的格式
											datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
											success: function(data) {
												console.log(JSON.stringify(data))
											},
											//调用出错执行的函数
											error: function(e) {
												//请求出错处理
											}
										});
									}else {
										
									}
								})
							}
						},
						//调用出错执行的函数
						error: function(e) {
							//请求出错处理
							console.log(JSON.stringify(e))
						}
					});
					}
				});
				
				model.widgetConfig({
					unit:{
						$type:"RadioGroup",
							items:[{
							    	label:"按箱维护",
							 		value:"1"
							 	},{
							 		label:"按量维护",
							 		value:"11111"
							 	}]
					}
				})
			});
		</script>
	</body>

</html>