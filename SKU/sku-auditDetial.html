<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="./resources/semantic.css">
		<link rel="stylesheet" type="text/css" href="./resources/cola.css">
		<link rel="stylesheet" type="text/css" href="css/auditDetial.css"/>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background-color: #439CF6;">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <h1 class="mui-title" style="color: white;">交货单审批</h1>
		</header>
		<div class="v-box" style="background-color: lavender;">
			<div class="v-box" id="rowBox">
				<label id="rowLabel">交货单编号：<span c-bind="data.receiptCode"></span></label>
				<label id="rowLabel">交货单状态：<span c-bind="data.receiptStatus"></span></label>
				<label id="rowLabel">箱数：<span c-bind="data.boxNum"></span></label> 
				<label id="rowLabel">数量：<span c-bind="data.productNum"></span></label>
				<label id="rowLabel">入库方式：<span c-bind="data.storageWay"></span></label>
				<label id="rowLabel">折扣率：<span c-bind="data.discount"></span>1</label>
				<label id="rowLabel">预计到货时间：<span c-bind="data.predictReceiptDate"></span></label>
				<label id="rowLabel">生产订单编号：<span c-bind="data.productionOrderCode"></span></label>
				<label id="rowLabel">客户编号：<span>待商议</span></label>
				<label id="rowLabel" style="margin-bottom: 1em;">生产订单状态：<span>待商议</span></label>
				<div class="flex-box" style="background-color: lavender;">
					<div class="box">
						<c-button id="buttonPosition" size="small" color="blue" c-widget="caption:装箱单详情;width:90%;click:detial" style="margin-left: 5%;"></c-button>
						<c-button id="buttonPosition" size="small" color="blue" c-widget="caption:采购订单详情;width:90%;click:purchaseDetial" style="margin-left: 5%;"></c-button>
						<c-button id="auditButton" size="small" color="blue" c-widget="caption:审核通过;width:90%;click:passWay" style="margin-left: 5%;"></c-button>
						<c-button id="buttonPosition" size="small" color="blue" c-widget="caption:退回;width:90%;click:comeBack" style="margin-left: 5%;"></c-button>
					</div>
				</div>
			</div>
		</div>
		
		<script src="./resources/jquery-2.1.3.js"></script> 
		<script src="./resources/3rd.js"></script>
		<script src="./resources/semantic.js"></script>
		<script src="./js/cola.js"></script>
		<script src="./resources/i18n/zh/cola.js"></script>
		<script src="./js/mui.min.js"></script>
		<script type="text/javascript">
			mui.init();
			cola(function(model){
				mui.plusReady(function(){
				var self = plus.webview.currentWebview();
				model.set("storageWay",self.storageWay);
				model.set("receiptStatus",self.receiptStatus);
				model.set("data",self.data);
				if(self.receiptStatus == "02"){
					cola.widget("auditButton").set("disabled",true);
				}
				}); 
				
				model.action({
					detial:function(){
						mui.openWindow({
						    url: 'sku-boxDetail.html', 
						    id:'boxDetial',
						    extras:{
						        receiptCode:model.get("data").get("receiptCode") //扩展参数
						    }
						 }); 
					},
					purchaseDetial:function(){
						mui.openWindow({
						    url: 'sku-purchaseOrder.html', 
						    id:'purchaseOrder',
						    extras:{
						        receiptCode:model.get("data").get("receiptCode"), //扩展参数
						        queryData:{
						        	productionOrderCode:model.get("data").get("productionOrderCode"),
						       		poCode:model.get("data").get("poCode")
						        }
						    }
						 }); 
					},
					passWay:function(){
						
						model.get("data").set("storageWay",model.get("storageWay"));
						model.get("data").set("receiptStatus",model.get("receiptStatus"));
						$.ajax({
								type: "POST",
								contentType:'application/json;charset=UTF-8',
								url: localStorage.getItem("localhost")+"/scmmk/rest/mobile/board/delivery_note/header/approve",
								//提交的数据
								//返回数据的格式
								datatype: "json", //"xml", "html", "script", "json", "jsonp", "text".
								data:JSON.stringify(model.get("data")),
								success: function(data) {
									console.log(JSON.stringify(data))
									if(data.msg == "success"){
										cola.widget("auditButton").set("disabled",true);
										//正常情况
										mui.toast('审批成功',{ duration:'short', type:'div' });
									}else{
										mui.confirm("剩余可收货数量小于当前交货单的数量，超出xxx,请确认是否继续审批","注意",function(value){
										if(value.index == 1){
											
										}else{
											
										}
									},"div");
									}
								},
								//调用出错执行的函数
								error: function(e) {
									//请求出错处理
								}
							});
						
						//剩余量不足情况
					}
				});
			});
			
		</script>
	</body>

</html>